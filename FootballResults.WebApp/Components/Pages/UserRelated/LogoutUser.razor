@page "/user/logout"
@attribute [Authorize(Roles = "User")]

@layout UserLayout

@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider

@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authorization

@code {
    [CascadingParameter]
    public HttpContext? HttpContext { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (HttpContext == null)
        {
            NavigationManager.Refresh(forceReload: true);
        }
        else if (HttpContext.User?.Identity?.IsAuthenticated ?? false)
        {
            await HttpContext.SignOutAsync();
            NavigationManager.NavigateTo("/", true);
        }
    }
}